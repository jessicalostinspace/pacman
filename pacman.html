<!DOCTYPE html>
<html lang="en">
	<head>
		<title>Jessica's Pacman Game</title>
		<link rel="stylesheet" type="text/css" href="pacman.css">
	</head>
	<body>
 		<div id="container">
			<div id="world"></div>
			<div id="pacman"></div>
			<div id="score">0</div>
			<div id="pacModal" class="modal">
				<!-- Modal content -->
				<div class="modal-content">
					<!-- <img class="dancing" src="dancing-bears-edited.png"> -->
<!-- 					<span class="close">&times;</span> -->
					<p>Sittin' plush with a royal flush</p>
					<p>üî¥üîµüî¥üîµüî¥üîµüî¥üîµ</p>
					<p id="score-display"></p>
					<p>üî¥üîµüî¥üîµüî¥üîµüî¥üîµ</p>
					<p id="high-score"></p>
					<button id="deadBtn">Ramble On</button>
				</div>	
			</div>	
		</div>

		<script>
			var score = 0;
			var scores = [];

			var pacman = {
				x: 1,
				y: 1
			};

			var world = [
				[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
				[2,0,1,1,2,1,1,1,1,2,3,1,1,2,5,2],
				[2,1,2,1,2,1,1,1,3,2,1,1,1,2,1,2],
				[2,1,2,1,2,1,1,2,2,2,2,6,1,2,1,2],
				[2,5,2,1,2,1,6,1,1,1,2,1,1,2,1,2],
				[2,1,2,1,2,1,1,1,2,1,2,1,2,2,1,2],
				[2,1,2,3,2,1,2,2,2,1,2,1,1,1,1,2],
				[2,1,2,2,2,1,2,1,1,1,2,1,2,2,1,2],			
				[2,1,1,1,1,1,2,1,1,1,2,1,1,2,1,2],
				[2,2,2,2,2,1,2,1,1,1,2,1,1,2,1,2],
				[2,1,1,1,1,1,2,1,6,1,2,3,1,2,1,2],
				[2,1,6,1,1,2,2,1,1,1,2,2,2,2,1,2],
				[2,3,1,1,1,2,1,1,1,1,1,1,1,1,1,2],
				[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]
			];


			function displayWorld(){
				var output = ' ';

				for(var i=0; i<world.length; i++){
					output += "\n<div class='row'>\n";
					for (var j=0; j<world[i].length; j++){
						if (world[i][j] == 2)
							output += "<div class='brick'></div>";
						if(world[i][j] == 1)
							output += "<div class='coin'></div>";
						if(world[i][j] == 0)
							output += "<div class='empty'></div>";
						if(world[i][j] == 3)
							output += "<div class='bonus'></div>";
						if(world[i][j] == 5)
							output += "<div class='endcharacter'></div>";
						if(world[i][j] == 6)
							output += "<div class='badguy'></div>";
					};
					output += "\n</div>";
				};
				console.log(output);
				document.getElementById("world").innerHTML = output;
			}

			function displayPacman(){
				document.getElementById("pacman").style.top = pacman.y*20+"px";
				document.getElementById("pacman").style.left = pacman.x*20+"px";
			}

			function displayScore(){
				document.getElementById("score").innerHTML = score;
			}

			function reset(){
				score = 0;
				pacman = {x: 1, y: 1};
				world = [
					[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],
					[2,0,1,1,2,1,1,1,1,2,3,1,1,2,5,2],
					[2,1,2,1,2,1,1,1,3,2,1,1,1,2,1,2],
					[2,1,2,1,2,1,1,2,2,2,2,6,1,2,1,2],
					[2,1,2,1,2,1,6,1,1,1,2,1,1,2,1,2],
					[2,5,2,1,2,1,1,1,2,1,2,1,2,2,1,2],
					[2,1,2,3,2,1,2,2,2,1,2,1,1,1,1,2],
					[2,1,2,2,2,1,2,1,1,1,2,1,2,2,1,2],			
					[2,1,1,1,1,1,2,1,1,1,2,1,1,2,1,2],
					[2,2,2,2,2,1,2,1,1,1,2,1,1,2,1,2],
					[2,1,1,1,1,1,2,1,6,1,2,3,1,2,1,2],
					[2,1,6,1,1,2,2,1,1,1,2,2,2,2,1,2],
					[2,3,1,1,1,2,1,1,1,1,1,1,1,1,1,2],
					[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2]];
				displayScore();
				displayPacman();
				displayWorld();
			}

			// Initial render
			displayWorld();
			displayPacman();
			displayScore();

			// ****************** MODAL ********************
			var modal = document.getElementById('pacModal');
			// Get the <span> element that closes the modal
			var span = document.getElementsByClassName("close")[0];
			// When the user clicks on <span> (x), close the modal
			// span.onclick = function() {
			//     modal.style.display = "none";
			// }
			// When the user clicks anywhere outside of the modal, close it
			window.onclick = function(event) {
			    if (event.target == modal) {
			        modal.style.display = "none";
			    }
			}

			document.onkeydown = function(e){
				if(e.keyCode == 37){
					pacman.x--;
					if(world[pacman.y][pacman.x] == 2){
						pacman.x++;
					}
				}
				else if(e.keyCode == 39){
					pacman.x++;
					if(world[pacman.y][pacman.x] == 2){
						pacman.x--;
					}				
				}
				else if(e.keyCode == 40){
					pacman.y++;
					if(world[pacman.y][pacman.x] == 2){
						pacman.y--;
					}
				}
				else if(e.keyCode == 38){
					pacman.y--;
					if(world[pacman.y][pacman.x] == 2){
						pacman.y++;
					}
				}	
				displayPacman();	

				if(world[pacman.y][pacman.x] == 1){
					score+=1;
					world[pacman.y][pacman.x] = 0;
					displayWorld();
					displayScore();
				}
				else if(world[pacman.y][pacman.x] == 6){
					score-=2;
					displayScore();	
				}
				else if(world[pacman.y][pacman.x] == 3){
					score+=5;
					world[pacman.y][pacman.x] = 0;
					displayWorld();
					displayScore();	
				}
				else if(world[pacman.y][pacman.x] == 5){

					// Cache the new score and find the highest in scores array
					scores.push(score);
					localStorage.scores = JSON.stringify(scores);
					var highScore = Math.max.apply(null, JSON.parse(localStorage.scores));

					// Display current and highest scores
					document.getElementById("score-display").innerHTML = "üî¥‚ö°Ô∏è‚ö°Ô∏è " + score + " ‚ö°Ô∏è‚ö°Ô∏èüî¥";
					document.getElementById("high-score").innerHTML = "Your highest score is " + highScore + ".";

					modal.style.display = "block";
					reset();
				}

				var button = document.getElementById("deadBtn")
				if(button.style.color == "black"){
					console.log("hi");
				}
			}
		</script>			
	</body>
</html>